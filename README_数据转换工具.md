# Excel到CSV转换工具使用说明

## 概述

这个工具用于将Excel文件中的RGB数值数据转换为训练脚本所需的CSV格式。它能够自动读取Excel文件中的R_R、R_G、R_B、G_R、G_G、G_B、B_R、B_G、B_B等工作表，并将数据转换为64x64的CSV文件。

## 文件说明

### 主要文件
- `excel_to_csv_converter.py` - 主要的转换工具
- `test_data_loading.py` - 数据加载测试脚本
- `副本B题附件：RGB数值1.xlsx` - 源Excel文件

### 生成的文件
转换后会在`数据集`目录下生成以下CSV文件：
- `R_R.csv` - R输出的R通道测量值
- `R_G.csv` - R输出的G通道测量值  
- `R_B.csv` - R输出的B通道测量值
- `G_R.csv` - G输出的R通道测量值
- `G_G.csv` - G输出的G通道测量值
- `G_B.csv` - G输出的B通道测量值
- `B_R.csv` - B输出的R通道测量值
- `B_G.csv` - B输出的G通道测量值
- `B_B.csv` - B输出的B通道测量值

## 使用方法

### 1. 运行转换工具

```bash
python excel_to_csv_converter.py
```

### 2. 验证数据加载

```bash
python test_data_loading.py
```

### 3. 开始训练

转换完成后，可以直接使用训练脚本：

```bash
cd Calibration
python train_calibration.py
```

## 工具特性

### 自动处理
- 自动检测Excel文件中的工作表
- 自动跳过标题行和列
- 自动处理非数值数据
- 自动调整数据尺寸为64x64

### 数据验证
- 检查文件是否存在
- 验证数据格式
- 输出详细的处理日志
- 提供数据统计信息

### 错误处理
- 优雅处理缺失的工作表
- 自动填充缺失数据
- 详细的错误信息

## 数据格式说明

### 输入格式
- Excel文件包含多个工作表
- 每个工作表对应一个RGB通道组合
- 数据从第二行第二列开始（跳过标题）

### 输出格式
- CSV文件，无标题行
- 64x64的数值矩阵
- 数值范围：0-255（RGB值）

## 与训练脚本的集成

转换后的CSV文件完全兼容`train_calibration.py`脚本：

1. **数据目录**: 默认为`数据集`目录
2. **文件命名**: 遵循`{输出颜色}_{测量通道}.csv`格式
3. **数据尺寸**: 64x64矩阵，符合训练脚本要求
4. **数据类型**: float32，优化内存使用

## 示例输出

```
============================================================
Excel到CSV转换工具
============================================================
2025-05-31 16:28:39,967 - INFO - 开始读取Excel文件: 副本B题附件：RGB数值1.xlsx
2025-05-31 16:28:40,988 - INFO - Excel文件包含的工作表: ['RGB目标值', 'R_R', 'R_G', 'R_B', 'G_R', 'G_G', 'G_B', 'B_R', 'B_G', 'B_B']
2025-05-31 16:28:40,988 - INFO - 找到工作表: R_R, 尺寸: (63, 64)
...
2025-05-31 16:28:41,070 - INFO - 转换完成！
2025-05-31 16:28:41,071 - INFO - 验证输出文件...
2025-05-31 16:28:41,075 - INFO - ✓ R_R.csv: 尺寸 (64, 64)
...

转换完成！CSV文件已保存到 '数据集' 目录中。
```

## 故障排除

### 常见问题

1. **Excel文件不存在**
   - 确保`副本B题附件：RGB数值1.xlsx`文件在当前目录
   - 检查文件名是否正确

2. **工作表缺失**
   - 工具会自动跳过缺失的工作表
   - 检查Excel文件中的工作表名称

3. **数据格式错误**
   - 工具会自动处理非数值数据
   - 缺失数据会被填充为0

4. **权限问题**
   - 确保有写入`数据集`目录的权限
   - 检查文件是否被其他程序占用

### 依赖要求

```bash
pip install pandas openpyxl numpy
```

## 技术细节

### 数据处理流程
1. 读取Excel文件的所有工作表
2. 筛选出需要的RGB通道工作表
3. 跳过标题行列，提取数值数据
4. 转换为float32类型
5. 调整尺寸为64x64
6. 保存为CSV格式

### 内存优化
- 使用pandas的高效数据处理
- float32类型减少内存占用
- 逐个处理工作表避免内存峰值

## 更新日志

### v1.0 (2025-05-31)
- 初始版本
- 支持Excel到CSV转换
- 自动数据验证
- 完整的错误处理 